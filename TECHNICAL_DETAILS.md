# Technical details

## Tech/framework used

### Back-end
* [Django 3.1](https://www.djangoproject.com/): High-level Python Web framework.
* [django-allauth](https://github.com/pennersr/django-allauth): Integrated set of Django applications addressing authentication, registration, account management as well as 3rd party (social) account authentication.
* [Django REST framework](https://www.django-rest-framework.org/): A powerful and flexible toolkit for building Web APIs.

### Front-end
* [Bulma](bulma.io/) : open source CSS framework based on Flexbox.


## Installation

### Development requirements
* [Python](https://www.python.org/) 3.8 (package `python3`);
* [venv module](https://docs.python.org/fr/3/library/venv.html) (package `python3-venv`).
* [Node.js](https://nodejs.org) 14.10.1 or higher;
* [npm](https://www.npmjs.com/) 6.14.8 or higher;
* [Elm](https://elm-lang.org/) 0.19.1-3 or higher;

### Production requirements
* [Python](https://www.python.org/) 3.8;
* [venv module](https://docs.python.org/fr/3/library/venv.html);
* [PostgreSQL](https://www.postgresql.org/) 9.6.
* [Psycopg](https://www.psycopg.org/) (package `python3-psycopg2`)

### Install development environment
Make sure you have the required packages installed on your machine, then install all the dev tools and run some Django initialization commands:
```
$ make install-dev
```
In a first terminal, run webpack on watch mode:
```
$ make watch
```
Then, in a second terminal, run the Django development server:
```
$ make serve
```
Finally, visit http://127.0.0.1:8000/ with your Web browser.

### Install production environment

Configure a PostgreSQL database.

Configure an email server.

Clone the repository.

Create a production environment. For instance at [alwaysdata](https://www.alwaysdata.com):
```
$ make install-prod-venv-alwaysdata
```

Create a new file named `production.py` in `myawesomeapp/settings` and write your production settings in it (you can rely on the example provided at `myawesomeapp/settings/production-example.py` and a useful command to generate a secret key is available with `$ make generate_secret_key`).

Edit `myawesomeapp/settings/__init__.py`:
```
from .production import *
```

Apply migrations and run some Django initialization commands:
```
$ make install-django
```

Collect static files:
```
$ make collectstatic
```

Finally, follow your favorite web hosting service instructions to serve your new app :)


## Workflow

### GitHub flow
For the sake of simplicity, to ease interaction with the community, we use the [GitHub flow](https://guides.github.com/introduction/flow/index.html) for open-source projects. In a few words:
* The `master` branch is always stable and deployable;
* Tags from the master branch are considered as releases;
* Contributors have to fork or create a new feature-branch to work on (if they are allowed to in the original repository) and propose a pull request to merge their branch to `master`.

### Development process
When you develop new features, we usually proceed like this:

On your local repository:
1. Create a feature branch.
2. Update requirements and upgrade your dev environment (see [BACKEND_INSTALL.md](BACKEND_INSTALL.md)):
```
$ make update-dev-venv
```
3. Create new migrations based on the changes you have made to your models:
```
$ make migrations
```
4. Apply migrations locally to make sure there are no issue:
```
$ make migrate
```
5. Build the front-end bundle in production mode:
```
$ make build
```
6. Commit, push, pull request, ...

On your prod server:
1. Pull your new codebase;
2. Update your prod environment:
```
$ make update-prod-venv
```
3. Apply migrations and collect static files:
```
$ make migrate
$ make collectstatic
```
4. Restart your server.

### Create a new app with Cookiecutter
__to do...__

### Deployment
__to do...__

### Tests
__to do...__


## Versioning
We use [SemVer](http://semver.org/) for versioning. See the [CHANGELOG.md](CHANGELOG.md) file for details.


## Best practices when dealing with Django/Python code
* Always use [Black](https://black.readthedocs.io/en/stable/)!


## Best practices when dealing with Elm code
* Always use [elm-format](https://elm-lang.org/)!


## How are the front-end and the back-end connected?
[Django webpack loader](https://github.com/owais/django-webpack-loader) consumes the output generated by [webpack-bundle-tracker](https://github.com/owais/webpack-bundle-tracker) and lets you use the generated bundles in django.

> :warning: **compatibility issue**: Use `webpack-bundle-tracker 0.4.3`.
Since version 1.0.0, `webpack-bundle-tracker` produces a different output which is not compatible with version 0.7.0 of `django-webpack-loader` (see [this issue](https://github.com/owais/django-webpack-loader/issues/227)).
```bash
$ npm install webpack-bundle-tracker@0.4.3 --save-dev
```
